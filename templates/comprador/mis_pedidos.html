<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Pedidos | AgroMarket</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos_comprador.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/breadcrumbs.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation-header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mis_pedidos.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Config -->
    <script src="{{ url_for('static', filename='js/firebase-config.js') }}"></script>
    <!-- Protección contra acceso después de logout -->
    <script src="{{ url_for('static', filename='js/auth-protection.js') }}"></script>
</head>
<body>
    <!-- ===== Menú superior ===== -->
    <nav>
        <div class="nav-left">
            <div class="logo"><h2>AgroMarket</h2></div>
            <div class="saludo-usuario">Hola, <strong>{{ nombre }}</strong></div>
        </div>
        <div class="menu">
            <a href="/comprador/panel" {% if page=='inicio' %}class="activo"{% endif %}>Inicio</a>
            <a href="/comprador/productos" {% if page=='productos' %}class="activo"{% endif %}>Productos</a>
            <a href="/comprador/carrito" {% if page=='carrito' %}class="activo"{% endif %}>Carrito</a>
            <a href="/comprador/mis_pedidos" {% if page=='mis_pedidos' %}class="activo"{% endif %}>Mis Pedidos</a>
            <a href="/comprador/chats" {% if page=='chats' %}class="activo"{% endif %}>Chats</a>
            <a href="/auth/perfil" {% if page=='perfil' %}class="activo"{% endif %}>Mi Perfil</a>
            <a href="/auth/logout">Cerrar Sesión</a>
        </div>
    </nav>

    <main class="main-content">
        <!-- Navigation Header -->
        <div class="navigation-header">
            <div></div>
            <div class="breadcrumbs">
                <a href="/comprador/panel"><i class="fas fa-home"></i> Inicio</a>
                <span>/</span>
                <a href="/auth/perfil">Mi cuenta</a>
                <span>/</span>
                <span><i class="fas fa-shopping-bag"></i> Mis pedidos</span>
            </div>
        </div>
        <div class="pedidos-container">
            <div class="pedidos-header">
                <h1><i class="fas fa-shopping-bag"></i> Mis Pedidos</h1>
                <p>Historial de todas tus compras realizadas</p>
            </div>

            <!-- Botones de filtros desplegables -->
            <div class="pedidos-filters">
                <div class="filter-dropdown">
                    <button class="filter-dropdown-btn" id="filter-estado-btn">
                        <i class="fas fa-filter"></i>
                        <span id="filter-estado-text">Todos</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="filter-dropdown-menu" id="filter-estado-menu">
                        <button class="filter-option active" data-filter="todos">
                            <i class="fas fa-list"></i> Todos
                        </button>
                        <button class="filter-option" data-filter="preparando">
                            <i class="fas fa-clock"></i> Preparando
                        </button>
                        <button class="filter-option" data-filter="enviado">
                            <i class="fas fa-shipping-fast"></i> Enviado
                        </button>
                        <button class="filter-option" data-filter="recibido">
                            <i class="fas fa-check-circle"></i> Recibido
                        </button>
                    </div>
                </div>
                <div class="filter-dropdown">
                    <button class="filter-dropdown-btn" id="filter-sort-btn">
                        <i class="fas fa-sort"></i>
                        <span id="filter-sort-text">Más reciente</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="filter-dropdown-menu" id="filter-sort-menu">
                        <button class="filter-option active" data-sort="reciente">
                            <i class="fas fa-calendar-alt"></i> Más reciente
                        </button>
                        <button class="filter-option" data-sort="antiguo">
                            <i class="fas fa-calendar"></i> Más antiguo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading state -->
            <div id="loading-pedidos" class="loading-pedidos">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Cargando pedidos...</p>
            </div>

            <!-- Empty state -->
            <div id="empty-pedidos" class="empty-pedidos" style="display: none;">
                <i class="fas fa-shopping-bag"></i>
                <h3>No tienes pedidos aún</h3>
                <p>Realiza tu primera compra para ver tus pedidos aquí</p>
                <a href="/comprador/productos" class="btn-ir-productos">Ir a Productos</a>
            </div>

            <!-- Container de pedidos -->
            <div id="pedidos-container" class="pedidos-list" style="display: none;">
                <!-- Los pedidos se cargarán dinámicamente -->
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/mis-pedidos.js') }}"></script>

</body>
</html>

