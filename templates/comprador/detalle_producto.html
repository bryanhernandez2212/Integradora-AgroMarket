<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Producto - AgroMarket</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos_comprador.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/breadcrumbs.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation-header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/detalle_producto.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="nav-left">
            <div class="logo"><h2>AgroMarket</h2></div>
            <div class="saludo-usuario">Hola, <strong id="nav-user-name">{{ nombre }}</strong></div>
        </div>
        <div class="menu">
            <a href="{{ url_for('comprador.panel_comprador') }}" {% if page=='inicio' %}class="activo"{% endif %}>Inicio</a>
            <a href="{{ url_for('comprador.ver_productos') }}" {% if page=='productos' %}class="activo"{% endif %}>Productos</a>
            <a href="{{ url_for('comprador.ver_carrito') }}" {% if page=='carrito' %}class="activo"{% endif %}>Carrito</a>
            <a href="{{ url_for('comprador.chats') }}" {% if page=='chats' %}class="activo"{% endif %}>Chats</a>
            <a href="{{ url_for('auth.perfil') }}" {% if page=='perfil' %}class="activo"{% endif %}>Mi Perfil</a>
            <a href="{{ url_for('auth.logout') }}">Cerrar Sesión</a>
        </div>
    </nav>

    <main class="product-detail-main" data-product-id="{{ producto_id }}">
        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <i class="fas fa-spinner"></i>
            <p>Cargando producto...</p>
        </div>

        <!-- Error State -->
        <div class="error-state" id="errorState" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Error al cargar el producto</h3>
            <p id="errorMessage"></p>
            <a href="{{ url_for('comprador.ver_productos') }}" class="btn btn-primary">Volver a Productos</a>
        </div>

        <!-- Product Content -->
        <div id="productContent" style="display: none;">
            <!-- Navigation Header -->
            <div class="navigation-header">
                <a href="{{ url_for('comprador.ver_productos') }}" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Volver a Productos
                </a>
                <!-- Breadcrumbs -->
                <div class="breadcrumb">
                    <a href="{{ url_for('comprador.panel_comprador') }}">Inicio</a>
                    <span>/</span>
                    <a href="{{ url_for('comprador.ver_productos') }}">Productos</a>
                    <span>/</span>
                    <span id="breadcrumb-category"></span>
                    <span>/</span>
                    <span id="breadcrumb-product"></span>
                </div>
            </div>

            <!-- Product Detail Container -->
            <div class="product-detail-container">
                <!-- Image Gallery Section -->
                <div class="product-image-section">
                    <div class="product-gallery">
                        <div class="main-image-container">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5TaW4gaW1hZ2VuPC90ZXh0Pjwvc3ZnPg==" alt="Producto" id="mainImage" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5TaW4gaW1hZ2VuPC90ZXh0Pjwvc3ZnPg=='">
                        </div>
                        <div class="thumbnail-gallery" id="thumbnailGallery">
                            <!-- Thumbnails se cargarán dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Product Info Section -->
                <div class="product-info-section">
                    <div class="product-header">
                        <h1 class="product-title" id="productTitle">Cargando...</h1>
                        <div class="product-category">
                            <span class="category-badge" id="productCategory">-</span>
                        </div>
                    </div>

                    <div class="price-stock-section">
                        <div class="price-section">
                            <span class="price-label">Precio:</span>
                            <span class="price-value" id="productPrice">$0.00 MXN</span>
                        </div>
                        <div class="stock-section">
                            <span class="stock-label">Stock disponible:</span>
                            <span class="stock-value" id="productStock">0</span>
                            <span class="stock-unit" id="productUnit">kg</span>
                        </div>
                    </div>

                    <div class="product-description">
                        <h3>Descripción</h3>
                        <p id="productDescription">Cargando descripción...</p>
                    </div>

                    <div class="quantity-section">
                        <label for="quantity">Cantidad:</label>
                        <div class="quantity-controls">
                            <button type="button" class="btn-quantity" id="decreaseBtn">-</button>
                            <input type="number" id="quantity" name="quantity" value="1" min="1" max="1" class="quantity-input">
                            <button type="button" class="btn-quantity" id="increaseBtn">+</button>
                        </div>
                        <span class="stock-info" id="stockInfo">Disponible: 0 unidades</span>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary add-to-cart-btn" id="addToCartBtn">
                            <i class="fas fa-shopping-cart"></i>
                            Agregar al Carrito
                        </button>
                        <button class="btn btn-success buy-now-btn" id="buyNowBtn">
                            <i class="fas fa-bolt"></i>
                            Comprar Ahora
                        </button>
                    </div>
                </div>
            </div>

            <!-- Seller Information Card -->
            <div class="seller-card" id="sellerCard">
                <div class="seller-header">
                    <div class="seller-avatar" id="sellerAvatar">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="seller-info">
                        <h3 id="sellerName">Cargando...</h3>
                        <p id="sellerEmail">-</p>
                    </div>
                </div>
                <div class="seller-details-grid">
                    <div class="seller-detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span id="sellerLocation" class="seller-location-link">Ubicación no disponible</span>
                    </div>
                    <div class="seller-detail-item">
                        <i class="fas fa-calendar"></i>
                        <span>Vendedor desde <span id="sellerSince">-</span></span>
                    </div>
                    <div class="seller-detail-item">
                        <i class="fas fa-box"></i>
                        <span><span id="sellerProducts">0</span> productos</span>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
                <div class="comments-header">
                    <h2><i class="fas fa-star"></i> Opiniones del producto</h2>
                    <button class="btn btn-primary" id="btn-mostrar-comentario">
                        <i class="fas fa-plus"></i>
                        Dejar un comentario
                    </button>
                </div>

                <!-- Rating Summary and Comments Container -->
                <div class="comments-container">
                    <!-- Rating Summary (Left Side - Smaller) -->
                    <div class="rating-summary-sidebar" id="ratingSummary" style="display: none;">
                        <div class="rating-score-compact">
                            <div class="rating-number-compact" id="ratingAverage">0.0</div>
                            <div class="rating-stars-compact" id="ratingStarsLarge"></div>
                            <div class="rating-count-compact" id="totalRatings">0 calificaciones</div>
                        </div>
                        <div class="rating-distribution-compact">
                            <div class="distribution-item-compact" data-rating="5">
                                <span class="star-label-compact">5 <i class="fas fa-star"></i></span>
                                <div class="distribution-bar-compact">
                                    <div class="distribution-fill-compact" data-fill="0"></div>
                                </div>
                                <span class="distribution-percent-compact" data-percent="0">0%</span>
                            </div>
                            <div class="distribution-item-compact" data-rating="4">
                                <span class="star-label-compact">4 <i class="fas fa-star"></i></span>
                                <div class="distribution-bar-compact">
                                    <div class="distribution-fill-compact" data-fill="0"></div>
                                </div>
                                <span class="distribution-percent-compact" data-percent="0">0%</span>
                            </div>
                            <div class="distribution-item-compact" data-rating="3">
                                <span class="star-label-compact">3 <i class="fas fa-star"></i></span>
                                <div class="distribution-bar-compact">
                                    <div class="distribution-fill-compact" data-fill="0"></div>
                                </div>
                                <span class="distribution-percent-compact" data-percent="0">0%</span>
                            </div>
                            <div class="distribution-item-compact" data-rating="2">
                                <span class="star-label-compact">2 <i class="fas fa-star"></i></span>
                                <div class="distribution-bar-compact">
                                    <div class="distribution-fill-compact" data-fill="0"></div>
                                </div>
                                <span class="distribution-percent-compact" data-percent="0">0%</span>
                            </div>
                            <div class="distribution-item-compact" data-rating="1">
                                <span class="star-label-compact">1 <i class="fas fa-star"></i></span>
                                <div class="distribution-bar-compact">
                                    <div class="distribution-fill-compact" data-fill="0"></div>
                                </div>
                                <span class="distribution-percent-compact" data-percent="0">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Comments Content (Right Side) -->
                    <div class="comments-content">
                        <!-- Comment Form -->
                        <div class="comment-form" id="commentForm" style="display: none;">
                            <h3>Escribe un comentario</h3>
                            <div class="comment-input-group">
                                <label>Calificación</label>
                                <div class="rating-input" id="ratingInput">
                                    <i class="fas fa-star" data-rating="1"></i>
                                    <i class="fas fa-star" data-rating="2"></i>
                                    <i class="fas fa-star" data-rating="3"></i>
                                    <i class="fas fa-star" data-rating="4"></i>
                                    <i class="fas fa-star" data-rating="5"></i>
                                </div>
                            </div>
                            <div class="comment-input-group">
                                <label for="commentText">Tu comentario</label>
                                <textarea id="commentText" placeholder="Comparte tu opinión sobre este producto..."></textarea>
                            </div>
                            <div class="comment-form-actions">
                                <button class="btn btn-primary" id="submitCommentBtn">
                                    <i class="fas fa-paper-plane"></i>
                                    Publicar Comentario
                                </button>
                                <button class="btn btn-secondary" id="cancelCommentBtn" style="display: none;">
                                    <i class="fas fa-times"></i>
                                    Cancelar
                                </button>
                            </div>
                        </div>

                        <!-- Comments List Header -->
                        <div class="comments-list-header">
                            <h3><span id="commentsCount">0</span> comentarios</h3>
                            <div class="comment-sort">
                                <select id="sortComments" class="sort-select">
                                    <option value="recientes">Más recientes</option>
                                    <option value="antiguos">Más antiguos</option>
                                    <option value="mejores">Mejores calificados</option>
                                    <option value="peores">Peores calificados</option>
                                </select>
                            </div>
                        </div>

                        <!-- Comments List -->
                        <div class="comment-list" id="commentsList">
                            <div class="no-comments">
                                <i class="fas fa-comment-slash"></i>
                                <p>Aún no hay comentarios. Sé el primero en opinar.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase SDKs -->
    <script src="{{ url_for('static', filename='js/firebase-config.js') }}"></script>
    <!-- Protección contra acceso después de logout -->
    <script src="{{ url_for('static', filename='js/auth-protection.js') }}"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script src="{{ url_for('static', filename='js/detalle_producto.js') }}"></script>
</body>
</html>
