<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Producto - AgroMarket</title>
    <link rel="stylesheet" href="/static/css/navbar.css">
    <link rel="stylesheet" href="/static/css/estilos_vendedor.css">
    <link rel="stylesheet" href="/static/css/breadcrumbs.css">
    <link rel="stylesheet" href="/static/css/navigation-header.css">
    <link rel="stylesheet" href="/static/css/formulario_productos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="{{ url_for('static', filename='js/mobile-menu.js') }}" defer></script>

    <!-- PWA: Manifest y theme color -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#2e8b57">

    <!-- Iconos -->
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='images/icons/icons-192.png') }}">
    <link rel="apple-touch-icon" sizes="512x512" href="{{ url_for('static', filename='images/icons/icons-512.png') }}">
</head>
<body data-page="agregar-producto">
    <!-- ===== Overlay para móviles ===== -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <nav>
        <button class="menu-toggle" id="menu-toggle" aria-label="Abrir menú">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="nav-left">
            <div class="logo"><h2>AgroMarket</h2></div>
            <div class="saludo-usuario">Hola, <strong>{{ nombre }}</strong></div>
        </div>
        <div class="menu">
ç            <a href="/vendedor/panel" {% if page == 'inicio' %}class="activo"{% endif %}>Home</a>
            <a href="/vendedor/agregar_producto" {% if page == 'agregar' %}class="activo"{% endif %}>Agregar Productos</a>
            <a href="/vendedor/mis_productos" {% if page == 'productos' %}class="activo"{% endif %}>Mis Productos</a>
            <a href="/vendedor/ventas" {% if page == 'ventas' %}class="activo"{% endif %}>Ventas</a>
            <a href="/vendedor/chats" {% if page == 'chats' %}class="activo"{% endif %}>Chats</a>
            <a href="/auth/perfil" {% if page == 'perfil' %}class="activo"{% endif %}>Mi Perfil</a>
            <a href="#" onclick="cerrarSesion()">Cerrar Sesión</a>
        </div>
    </nav>
    
    <!-- ===== Sidebar para móviles ===== -->
    <aside class="sidebar-menu" id="sidebar-menu">
        <!-- Header con foto de perfil y nombre -->
        <div class="sidebar-header-profile">
            <div class="sidebar-profile-avatar" id="sidebar-profile-avatar">
                <img id="sidebar-profile-avatar-img" src="" alt="Foto de perfil" style="display: none;">
                <i class="fas fa-user-circle" id="sidebar-profile-avatar-icon"></i>
            </div>
            <div class="sidebar-profile-info">
                <p class="sidebar-profile-name" id="sidebar-profile-name">{{ nombre }}</p>
                <p class="sidebar-profile-email" id="sidebar-profile-email">{{ session.get('email', '') }}</p>
            </div>
        </div>
        <div class="menu">
            <a href="/vendedor/panel" {% if page == 'inicio' %}class="activo"{% endif %}>
                <span>Home</span>
            </a>
            <a href="/vendedor/agregar_producto" {% if page == 'agregar' %}class="activo"{% endif %}>
                <span>Agregar Productos</span>
            </a>
            <a href="/vendedor/mis_productos" {% if page == 'productos' %}class="activo"{% endif %}>
                <span>Mis Productos</span>
            </a>
            <a href="/vendedor/ventas" {% if page == 'ventas' %}class="activo"{% endif %}>
                <span>Ventas</span>
            </a>
            <a href="/vendedor/chats" {% if page == 'chats' %}class="activo"{% endif %}>
                <span>Chats</span>
            </a>
            <a href="/auth/perfil" {% if page == 'perfil' %}class="activo"{% endif %}>
                <span>Mi Perfil</span>
            </a>
            <a href="#" onclick="cerrarSesion()">
                <span>Cerrar Sesión</span>
            </a>
        </div>
    </aside>

<main>
    <!-- Navigation Header -->
    <div class="navigation-header">
        <div></div>
        <div class="breadcrumbs">
            <a href="/vendedor/panel">Inicio</a>
            <span>/</span>
            <span>Agregar producto</span>
        </div>
    </div>
    <h1>Agregar Producto</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="product-form-container">
        <form id="productForm" class="form-two-columns">
            <!-- Columna izquierda: Campos del formulario -->
            <div class="form-left-column">
                <div class="form-group">
                    <label for="nombre">Nombre del producto:</label>
                    <input type="text" id="nombre" name="nombre" placeholder="Ej: Manzanas rojas" required maxlength="100">
                    <div id="nombre-error" class="field-error" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="nombre-error-texto"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripción:</label>
                    <textarea id="descripcion" name="descripcion" placeholder="Describe tu producto, origen, características especiales, etc." required maxlength="1000"></textarea>
                    <div id="descripcion-error" class="field-error" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="descripcion-error-texto"></span>
                    </div>
                    <small class="char-counter">
                        <span id="descripcion-counter">0</span>/1000 caracteres
                    </small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="categoria">Categoría:</label>
                        <select id="categoria" name="categoria" required>
                            <option value="">--Selecciona una--</option>
                            <option value="frutas">Frutas</option>
                            <option value="verduras">Verduras</option>
                            <option value="granos">Granos</option>
                            <option value="lacteos">Lácteos</option>
                            <option value="carnes">Carnes</option>
                            <option value="semillas">Semillas</option>
                            <option value="otros">Otros</option>
                        </select>
                        <div id="categoria-error" class="field-error" style="display: none;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Debes seleccionar una categoría</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="unidad">Unidad mínima:</label>
                        <select id="unidad" name="unidad" required>
                            <option value="">--Selecciona una--</option>
                            <option value="kg">kg</option>
                            <option value="reja">Reja</option>
                            <option value="tonelada">Tonelada</option>
                        </select>
                        <div id="unidad-mensaje" class="unidad-mensaje" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>Mínimo 5 kg por unidad</span>
                        </div>
                        <div id="unidad-error" class="field-error" style="display: none;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Debes seleccionar una unidad</span>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="precio">Precio (MXN):</label>
                        <input type="number" id="precio" name="precio" min="0" step="0.01" placeholder="25.50" required>
                        <div id="precio-error" class="field-error" style="display: none;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span id="precio-error-texto"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="descuento">Descuento (%):</label>
                        <input type="number" id="descuento" name="descuento" min="0" max="100" step="1" placeholder="0" value="0">
                        <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            <i class="fas fa-info-circle"></i> Opcional: porcentaje de descuento (0-100)
                        </small>
                        <div id="precio-con-descuento" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: #e8f5e9; border-radius: 4px; font-size: 0.9rem;">
                            <strong style="color: #2e8b57;">Precio con descuento: $<span id="precio-descuento-valor">0.00</span></strong>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock">Cantidad disponible:</label>
                        <input type="number" id="stock" name="stock" min="1" step="1" placeholder="100" required>
                        <div id="stock-mensaje" class="stock-mensaje" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span id="stock-mensaje-texto">Mínimo 5 unidades</span>
                        </div>
                        <div id="stock-error" class="stock-error" style="display: none;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>El mínimo son 5 kg. No se permiten valores menores.</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna derecha: Imágenes y botón -->
            <div class="form-right-column">
                <div class="form-group">
                    <label for="imagen">Imágenes del producto:</label>
                    <div class="image-upload-container">
                        <input type="file" id="imagen" name="imagen" accept="image/*" multiple style="display: none;">
                        <div class="image-upload-area" id="imageUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Haz clic para seleccionar una o más imágenes</p>
                            <small>Formatos: JPG, PNG, GIF (máx. 5MB cada una. Máximo 5 imágenes)</small>
                        </div>
                        <div class="images-preview-container" id="imagesPreviewContainer" style="display: none;">
                            <div class="images-grid" id="imagesGrid">
                                <!-- Las imágenes se agregarán aquí dinámicamente -->
                            </div>
                            <div class="images-actions">
                                <button type="button" id="addMoreImagesBtn" class="add-more-images-btn">
                                    <i class="fas fa-plus"></i> Subir más imágenes
                                </button>
                                <button type="button" id="removeAllImages" class="remove-all-btn">
                                    <i class="fas fa-trash"></i> Eliminar todas
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-upload"></i> Publicar Producto
                </button>
            </div>
        </form>
    </div>
</main>


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

<!-- Firebase Instant -->
<script src="/static/js/firebase-instant.js"></script>
<!-- Protección contra acceso después de logout -->
<script src="{{ url_for('static', filename='js/auth-protection.js') }}"></script>
<script src="{{ url_for('static', filename='js/productos-common.js') }}"></script>
<script src="{{ url_for('static', filename='js/security-validation.js') }}"></script>
<script src="{{ url_for('static', filename='js/productos-agregar.js') }}"></script>
</body>
</html>
